<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéß Browser Jockey - Dual Track DJ Mixer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéß</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.0/lame.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@15.0.4/build/Tone.js"></script>
</head>
<body>
    <div class="container">
        <header class="page-header">
            <h1>Browser Jockey</h1>
            <a href="https://github.com/liorshahverdi/browser_jockey" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
                <svg width="32" height="32" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
            </a>
        </header>
        
        <div class="controls">
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="mixer">üéõÔ∏è DJ Mixer</button>
                <button class="tab-btn" data-tab="sequencer">üéº Sequencer</button>
            </div>

            <!-- DJ Mixer Tab -->
            <div id="mixer-tab" class="tab-content active">
            <!-- DJ Layout: Three Column Layout (Track 1 | Mixer | Track 2) -->
            <div class="dj-decks-container">
                <!-- Left Column: Track 1 -->
                <div class="track-upload">
                    <label>Track 1</label>
                    
                    <!-- Vinyl Animation -->
                    <div class="vinyl-animation" id="vinylAnimation1" style="display: none;">
                        <div class="vinyl-record">
                            <div class="vinyl-center"></div>
                            <div class="vinyl-groove"></div>
                            <div class="vinyl-groove"></div>
                            <div class="vinyl-groove"></div>
                        </div>
                    </div>
                    
                    <div class="track-main-content">
                        <div class="upload-section">
                            <label for="audioFile1" class="upload-btn">
                                <span>üìÅ Choose Audio</span>
                                <input type="file" id="audioFile1" accept="audio/*,video/*,.mp3,.wav,.ogg,.m4a,.aac,.flac,.wma,.aiff,.aif,.opus,.webm,.oga,.mp4,.avi,.mov" hidden>
                            </label>
                            <button id="captureTabAudio1" class="upload-btn" title="Capture audio from another browser tab">
                                <span>üéµ Capture Tab Audio</span>
                            </button>
                            <span id="fileName1" class="file-name">No file selected</span>
                            <div class="waveform-color-picker">
                                <label for="waveformColor1">Waveform Color:</label>
                                <input type="color" id="waveformColor1" value="#00ffff" title="Choose waveform color">
                                <button id="resetColor1" class="reset-color-btn" title="Reset to default">‚Ü∫</button>
                            </div>
                        </div>
                        <div class="waveform-container">
                            <canvas id="waveform1" class="waveform-canvas"></canvas>
                            <div id="waveformProgress1" class="waveform-progress"></div>
                            <div id="loopMarkerStart1" class="loop-marker loop-marker-start" style="display: none;">A</div>
                            <div id="loopMarkerEnd1" class="loop-marker loop-marker-end" style="display: none;">B</div>
                            <div id="loopRegion1" class="loop-region" style="display: none;"></div>
                            <div id="timeTooltip1" class="time-tooltip" style="display: none;">0:00.000</div>
                        </div>
                        <div class="waveform-zoom-controls">
                            <button id="zoomInBtn1" class="zoom-btn" title="Zoom in">üîç+</button>
                            <button id="zoomOutBtn1" class="zoom-btn" title="Zoom out">üîç‚àí</button>
                            <button id="zoomResetBtn1" class="zoom-btn" title="Reset zoom">‚ü≤</button>
                            <span class="zoom-info">Zoom: <span id="zoomLevel1">1.0x</span></span>
                            <span id="hoverTime1" class="hover-time" style="display: none;">Hover: <span>--</span></span>
                        </div>
                        <div class="track-info">
                            <span class="bpm-display">BPM: <span id="bpm1">--</span></span>
                            <span class="key-display-inline">Key: <span id="key1">--</span></span>
                            <span class="duration-display"><span id="currentTime1">0:00</span> / <span id="duration1">0:00</span></span>
                        </div>
                        <div class="track-controls">
                            <button id="playBtn1" class="control-btn-small" disabled>‚ñ∂Ô∏è</button>
                            <button id="pauseBtn1" class="control-btn-small" disabled>‚è∏Ô∏è</button>
                            <button id="stopBtn1" class="control-btn-small" disabled>‚èπÔ∏è</button>
                            <button id="loopBtn1" class="control-btn-small loop-btn" disabled title="Enable loop (click waveform twice to set A-B points)">üîÅ</button>
                            <button id="reverseLoopBtn1" class="control-btn-small reverse-loop-btn" disabled title="Enable reverse loop">üîÅ‚è™</button>
                            <button id="clearLoopBtn1" class="control-btn-small" disabled title="Clear loop points">‚ùå</button>
                        </div>
                    </div>
                    
                    <div class="track-controls-panel">
                        <div class="quick-loop-section" style="display: none;" id="quickLoopSection1">
                            <label class="quick-loop-label">Quick Loop:</label>
                            <div class="quick-loop-buttons">
                                <button class="quick-loop-btn" data-bars="1" data-track="1">1 Bar</button>
                                <button class="quick-loop-btn" data-bars="2" data-track="1">2 Bars</button>
                                <button class="quick-loop-btn" data-bars="4" data-track="1">4 Bars</button>
                                <button class="quick-loop-btn" data-bars="8" data-track="1">8 Bars</button>
                            </div>
                            <label class="loop-info-label">
                                <input type="checkbox" id="autoZoom1" checked>
                                Auto-zoom to loop
                            </label>
                        </div>
                        <div class="precise-loop-section" style="display: none;" id="preciseLoopSection1">
                            <label class="precise-loop-label">Precise Loop Points (seconds):</label>
                            <div class="precise-loop-inputs">
                                <div class="precise-loop-input-group">
                                    <label for="loopStartInput1">A:</label>
                                    <input type="number" id="loopStartInput1" class="loop-time-input" min="0" step="0.001" disabled>
                                </div>
                                <div class="precise-loop-input-group">
                                    <label for="loopEndInput1">B:</label>
                                    <input type="number" id="loopEndInput1" class="loop-time-input" min="0" step="0.001" disabled>
                                </div>
                            </div>
                            <div class="loop-hint">
                                üí° Click to set <strong>A</strong> and <strong>B</strong> ‚Ä¢ Click again to adjust nearest marker ‚Ä¢ Hover to see time
                            </div>
                        </div>
                        <div class="tempo-volume-row">
                            <div class="volume-control-inline">
                                <label>Volume: <span id="volumeValue1">100%</span></label>
                                <input type="range" id="volumeSlider1" min="0" max="100" step="1" value="100" class="volume-slider">
                            </div>
                            <div class="tempo-control-inline">
                                <label>Tempo: <span id="tempoValue1">1.0x</span></label>
                                <input type="range" id="tempoSlider1" min="0.25" max="2.0" step="0.05" value="1.0">
                            </div>
                            <div class="stretch-control-inline">
                                <label>Stretch: <span id="stretchValue1">1.0x</span></label>
                                <input type="range" id="stretchSlider1" min="0.5" max="2.0" step="0.05" value="1.0" class="stretch-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>Low: <span id="lowValue1">0dB</span></label>
                                <input type="range" id="lowSlider1" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>Mid: <span id="midValue1">0dB</span></label>
                                <input type="range" id="midSlider1" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>High: <span id="highValue1">0dB</span></label>
                                <input type="range" id="highSlider1" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="pitch-control-inline">
                                <label>Pitch: <span id="pitchValue1">0</span></label>
                                <input type="range" id="pitchSlider1" min="-12" max="12" step="0.1" value="0" class="pitch-slider">
                            </div>
                        </div>
                        <div class="pan-control-inline">
                            <label>Pan: <span id="panValue1">Center</span></label>
                            <input type="range" id="panSlider1" min="-100" max="100" step="1" value="0" class="pan-slider">
                        </div>
                        <div class="effect-chain-container" id="effectChain1">
                            <!-- Effect chain UI will be dynamically generated here -->
                        </div>
                        <div class="effects-section">
                            <div class="effects-header">üéõÔ∏è Effects</div>
                            <div id="filterControl1" class="effect-control">
                                <label>Filter: <span id="filterValue1">20kHz</span></label>
                                <input type="range" id="filterSlider1" min="20" max="20000" step="10" value="20000" class="effect-slider">
                                <select id="filterType1" class="filter-type-select">
                                    <option value="lowpass">Low Pass</option>
                                    <option value="highpass">High Pass</option>
                                    <option value="bandpass">Band Pass</option>
                                </select>
                            </div>
                            <div id="adsrControl1" class="effect-control" style="display: none;">
                                <div class="adsr-header">
                                    <label>üìä ADSR Envelope</label>
                                    <button id="adsrTrigger1" class="adsr-trigger-btn" title="Trigger envelope">‚ö° Trigger</button>
                                </div>
                                <div class="adsr-controls">
                                    <div class="adsr-param">
                                        <label>Attack: <span id="adsrAttackValue1">10ms</span></label>
                                        <input type="range" id="adsrAttackSlider1" min="1" max="2000" step="1" value="10" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Decay: <span id="adsrDecayValue1">100ms</span></label>
                                        <input type="range" id="adsrDecaySlider1" min="1" max="2000" step="1" value="100" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Sustain: <span id="adsrSustainValue1">80%</span></label>
                                        <input type="range" id="adsrSustainSlider1" min="0" max="100" step="1" value="80" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Release: <span id="adsrReleaseValue1">300ms</span></label>
                                        <input type="range" id="adsrReleaseSlider1" min="1" max="5000" step="1" value="300" class="effect-slider">
                                    </div>
                                </div>
                            </div>
                            <div id="reverbControl1" class="effect-control">
                                <label>Reverb: <span id="reverbValue1">0%</span></label>
                                <input type="range" id="reverbSlider1" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayControl1" class="effect-control">
                                <label>Delay: <span id="delayValue1">0%</span></label>
                                <input type="range" id="delaySlider1" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayTimeControl1" class="effect-control">
                                <label>Delay Time: <span id="delayTimeValue1">300ms</span></label>
                                <input type="range" id="delayTimeSlider1" min="50" max="2000" step="50" value="300" class="effect-slider">
                            </div>
                        </div>
                        <div class="export-section">
                            <div class="export-header">üíæ Export</div>
                            <div class="export-format-selector">
                                <label>Format:</label>
                                <select id="exportFormat1" class="export-format-select">
                                    <option value="wav" selected>WAV (lossless)</option>
                                    <option value="mp3">MP3 (compressed)</option>
                                </select>
                            </div>
                            <button id="exportStem1" class="export-btn" disabled>Export Track</button>
                            <button id="exportLoop1" class="export-btn" disabled>Export Loop</button>
                        </div>
                    </div>
                </div>
                
                <!-- Center Column: DJ Mixer Section -->
                <div class="dj-mixer-section">
                    <div class="mixer-header">üéõÔ∏è DJ MIXER</div>
                
                <!-- Dual Track Controls -->
                <div class="dual-track-controls-section">
                    <div class="dual-controls-header">üéöÔ∏è Dual Track Controls</div>
                    <div class="dual-controls-buttons">
                        <button id="playBothBtn" class="control-btn dual-control-btn" disabled>
                            <span class="dual-icon">‚ñ∂Ô∏è‚ñ∂Ô∏è</span> Play Both Tracks
                        </button>
                        <button id="playBothRecordBtn" class="control-btn dual-control-btn" disabled>
                            <span class="dual-icon">‚ñ∂Ô∏è‚è∫Ô∏è</span> Play Both & Record
                        </button>
                    </div>
                </div>
                
                <!-- Crossfader Section -->
                <div class="crossfader-section">
                    <div class="crossfader-header">‚ö° Crossfader</div>
                    <div class="crossfader-mode-select">
                        <label>Mode:</label>
                        <select id="crossfaderMode" class="crossfader-mode-dropdown">
                            <option value="track1-track2" selected>Track 1 ‚Üî Track 2</option>
                            <option value="track1-mic">Track 1 ‚Üî Microphone</option>
                            <option value="track2-mic">Track 2 ‚Üî Microphone</option>
                        </select>
                    </div>
                    <div class="crossfader-control">
                        <div class="crossfader-labels">
                            <span class="crossfader-label-left" id="crossfaderLabelLeft">Track 1</span>
                            <span class="crossfader-label-center">CENTER</span>
                            <span class="crossfader-label-right" id="crossfaderLabelRight">Track 2</span>
                        </div>
                        <input type="range" id="crossfader" min="0" max="100" step="1" value="50" class="crossfader-slider">
                        <div class="crossfader-value">
                            <span id="crossfaderValue">50% / 50%</span>
                        </div>
                    </div>
                </div>
                
                <div class="microphone-section">
                    <div class="mic-header">üé§ Microphone Input</div>
                    <div class="mic-controls">
                        <button id="enableMicBtn" class="control-btn">
                            <span class="mic-icon">üé§</span> Enable Microphone
                        </button>
                        <button id="captureTabAudioMic" class="control-btn">
                            <span class="mic-icon">üéµ</span> Capture Tab Audio as Mic
                        </button>
                        <button id="disableMicBtn" class="control-btn" disabled style="display: none;">
                            <span class="mic-icon">üîá</span> Disable Microphone
                        </button>
                        <div class="mic-volume-control" style="display: none;" id="micVolumeControl">
                            <label>Mic Volume: <span id="micVolumeValue">100%</span></label>
                            <input type="range" id="micVolumeSlider" min="0" max="100" step="1" value="100" class="volume-slider">
                        </div>
                        <div class="mic-monitoring" style="display: none;" id="micMonitoring">
                            <label>
                                <input type="checkbox" id="micMonitorCheckbox">
                                Monitor (hear yourself)
                            </label>
                        </div>
                    </div>
                    
                    <!-- Microphone Recording Section -->
                    <div class="mic-recording-section" style="display: none;" id="micRecordingSection">
                        <div class="mic-recording-header">üéôÔ∏è Microphone Recording</div>
                        <div class="mic-recording-controls">
                            <button id="micRecordBtn" class="control-btn">
                                <span>‚è∫Ô∏è</span> Record Mic
                            </button>
                            <button id="micStopBtn" class="control-btn" disabled style="display: none;">
                                <span>‚èπÔ∏è</span> Stop Recording
                            </button>
                            <span id="micRecordingTime" class="recording-time" style="display: none;">0:00</span>
                        </div>
                        <div class="mic-recording-waveform-container" style="display: none;" id="micRecordingWaveformContainer">
                            <canvas id="micRecordingWaveform" class="waveform-canvas"></canvas>
                        </div>
                        <div class="mic-recording-playback" style="display: none;" id="micRecordingPlayback">
                            <audio id="micRecordingAudio" controls></audio>
                            <div class="mic-recording-actions">
                                <div class="mic-recording-load">
                                    <label>Load to Track:</label>
                                    <button id="micLoadToTrack1Btn" class="load-track-btn">üéµ Track 1</button>
                                    <button id="micLoadToTrack2Btn" class="load-track-btn">üéµ Track 2</button>
                                </div>
                                <div class="mic-recording-export">
                                    <button id="micExportWavBtn" class="export-btn">üíæ Export as WAV</button>
                                    <button id="micExportMp3Btn" class="export-btn">üíæ Export as MP3</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="vocoder-section" style="display: none;" id="vocoderSection">
                        <div class="vocoder-header">ü§ñ Vocoder Effect</div>
                        <div class="vocoder-controls">
                            <div class="vocoder-control">
                                <label>Modulator (Voice):</label>
                                <select id="vocoderModulator" class="vocoder-select">
                                    <option value="mic" selected>Microphone</option>
                                    <option value="track1">Track 1</option>
                                    <option value="track2">Track 2</option>
                                </select>
                            </div>
                            <div class="vocoder-control">
                                <label>Carrier Source:</label>
                                <select id="vocoderCarrier" class="vocoder-select">
                                    <option value="track1">Track 1</option>
                                    <option value="track2">Track 2</option>
                                    <option value="mix" selected>Both Tracks (Mix)</option>
                                    <option value="mic">Microphone (Feedback)</option>
                                </select>
                            </div>
                            <button id="enableVocoderBtn" class="vocoder-btn">
                                Enable Vocoder
                            </button>
                            <button id="disableVocoderBtn" class="vocoder-btn" disabled style="display: none;">
                                Disable Vocoder
                            </button>
                            <div class="vocoder-settings" style="display: none;" id="vocoderSettings">
                                <div class="vocoder-control">
                                    <label>Dry/Wet Mix: <span id="vocoderMixValue">100%</span></label>
                                    <input type="range" id="vocoderMixSlider" min="0" max="100" step="1" value="100" class="effect-slider">
                                </div>
                                <div class="vocoder-control">
                                    <label>Bands: <span id="vocoderBandsValue">16</span></label>
                                    <input type="range" id="vocoderBandsSlider" min="8" max="32" step="8" value="16" class="effect-slider">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="autotune-section" style="display: none;" id="autotuneSection">
                        <div class="autotune-header">üéµ Auto-Tune Effect</div>
                        <div class="autotune-controls">
                            <div class="autotune-control">
                                <label>Audio Source:</label>
                                <select id="autotuneSource" class="autotune-select">
                                    <option value="mic" selected>Microphone</option>
                                    <option value="track1">Track 1</option>
                                    <option value="track2">Track 2</option>
                                </select>
                            </div>
                            <button id="enableAutotuneBtn" class="autotune-btn">
                                Enable Auto-Tune
                            </button>
                            <button id="disableAutotuneBtn" class="autotune-btn" disabled style="display: none;">
                                Disable Auto-Tune
                            </button>
                            <div class="autotune-settings" style="display: none;" id="autotuneSettings">
                                <div class="autotune-control">
                                    <label>Key:</label>
                                    <select id="autotuneKey" class="autotune-select">
                                        <option value="C">C</option>
                                        <option value="C#">C#</option>
                                        <option value="D">D</option>
                                        <option value="D#">D#</option>
                                        <option value="E">E</option>
                                        <option value="F">F</option>
                                        <option value="F#">F#</option>
                                        <option value="G">G</option>
                                        <option value="G#">G#</option>
                                        <option value="A" selected>A</option>
                                        <option value="A#">A#</option>
                                        <option value="B">B</option>
                                    </select>
                                </div>
                                <div class="autotune-control">
                                    <label>Scale:</label>
                                    <select id="autotuneScale" class="autotune-select">
                                        <option value="major" selected>Major</option>
                                        <option value="minor">Minor</option>
                                        <option value="chromatic">Chromatic</option>
                                    </select>
                                </div>
                                <div class="autotune-control">
                                    <label>Correction Speed: <span id="autotuneSpeedValue">50ms</span></label>
                                    <input type="range" id="autotuneSpeedSlider" min="0" max="200" step="10" value="50" class="effect-slider">
                                </div>
                                <div class="autotune-control">
                                    <label>Strength: <span id="autotuneStrengthValue">100%</span></label>
                                    <input type="range" id="autotuneStrengthSlider" min="0" max="100" step="5" value="100" class="effect-slider">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mic-waveform-container" style="display: none;" id="micWaveformContainer">
                        <label>Mic Input Level:</label>
                        <canvas id="micWaveform" class="waveform-canvas" style="height: 60px;"></canvas>
                    </div>
                </div>
                
                </div>
                
                <!-- Right Column: Track 2 -->
                <div class="track-upload">
                    <label>Track 2</label>
                    
                    <!-- Vinyl Animation -->
                    <div class="vinyl-animation" id="vinylAnimation2" style="display: none;">
                        <div class="vinyl-record">
                            <div class="vinyl-center"></div>
                            <div class="vinyl-groove"></div>
                            <div class="vinyl-groove"></div>
                            <div class="vinyl-groove"></div>
                        </div>
                    </div>
                    
                    <div class="track-main-content">
                        <div class="upload-section">
                            <label for="audioFile2" class="upload-btn">
                                <span>üìÅ Choose Audio</span>
                                <input type="file" id="audioFile2" accept="audio/*,video/*,.mp3,.wav,.ogg,.m4a,.aac,.flac,.wma,.aiff,.aif,.opus,.webm,.oga,.mp4,.avi,.mov" hidden>
                            </label>
                            <button id="captureTabAudio2" class="upload-btn" title="Capture audio from another browser tab">
                                <span>üéµ Capture Tab Audio</span>
                            </button>
                            <span id="fileName2" class="file-name">No file selected</span>
                            <div class="waveform-color-picker">
                                <label for="waveformColor2">Waveform Color:</label>
                                <input type="color" id="waveformColor2" value="#ff00ff" title="Choose waveform color">
                                <button id="resetColor2" class="reset-color-btn" title="Reset to default">‚Ü∫</button>
                            </div>
                        </div>
                        <div class="waveform-container">
                            <canvas id="waveform2" class="waveform-canvas"></canvas>
                            <div id="waveformProgress2" class="waveform-progress"></div>
                            <div id="loopMarkerStart2" class="loop-marker loop-marker-start" style="display: none;">A</div>
                            <div id="loopMarkerEnd2" class="loop-marker loop-marker-end" style="display: none;">B</div>
                            <div id="loopRegion2" class="loop-region" style="display: none;"></div>
                            <div id="timeTooltip2" class="time-tooltip" style="display: none;">0:00.000</div>
                        </div>
                        <div class="waveform-zoom-controls">
                            <button id="zoomInBtn2" class="zoom-btn" title="Zoom in">üîç+</button>
                            <button id="zoomOutBtn2" class="zoom-btn" title="Zoom out">üîç‚àí</button>
                            <button id="zoomResetBtn2" class="zoom-btn" title="Reset zoom">‚ü≤</button>
                            <span class="zoom-info">Zoom: <span id="zoomLevel2">1.0x</span></span>
            <span id="hoverTime2" class="hover-time" style="display: none;">Hover: <span>--</span></span>
                        </div>
                        <div class="track-info">
                            <span class="bpm-display">BPM: <span id="bpm2">--</span></span>
                            <span class="key-display-inline">Key: <span id="key2">--</span></span>
                            <span class="duration-display"><span id="currentTime2">0:00</span> / <span id="duration2">0:00</span></span>
                        </div>
                        <div class="track-controls">
                            <button id="playBtn2" class="control-btn-small" disabled>‚ñ∂Ô∏è</button>
                            <button id="pauseBtn2" class="control-btn-small" disabled>‚è∏Ô∏è</button>
                            <button id="stopBtn2" class="control-btn-small" disabled>‚èπÔ∏è</button>
                            <button id="loopBtn2" class="control-btn-small loop-btn" disabled title="Enable loop (click waveform twice to set A-B points)">üîÅ</button>
                            <button id="reverseLoopBtn2" class="control-btn-small reverse-loop-btn" disabled title="Enable reverse loop">üîÅ‚è™</button>
                            <button id="clearLoopBtn2" class="control-btn-small" disabled title="Clear loop points">‚ùå</button>
                        </div>
                    </div>
                    
                    <div class="track-controls-panel">
                        <div class="quick-loop-section" style="display: none;" id="quickLoopSection2">
                            <label class="quick-loop-label">Quick Loop:</label>
                            <div class="quick-loop-buttons">
                                <button class="quick-loop-btn" data-bars="1" data-track="2">1 Bar</button>
                                <button class="quick-loop-btn" data-bars="2" data-track="2">2 Bars</button>
                                <button class="quick-loop-btn" data-bars="4" data-track="2">4 Bars</button>
                                <button class="quick-loop-btn" data-bars="8" data-track="2">8 Bars</button>
                            </div>
                            <label class="loop-info-label">
                                <input type="checkbox" id="autoZoom2" checked>
                                Auto-zoom to loop
                            </label>
                        </div>
                        <div class="precise-loop-section" style="display: none;" id="preciseLoopSection2">
                            <label class="precise-loop-label">Precise Loop Points (seconds):</label>
                            <div class="precise-loop-inputs">
                                <div class="precise-loop-input-group">
                                    <label for="loopStartInput2">A:</label>
                                    <input type="number" id="loopStartInput2" class="loop-time-input" min="0" step="0.001" disabled>
                                </div>
                                <div class="precise-loop-input-group">
                                    <label for="loopEndInput2">B:</label>
                                    <input type="number" id="loopEndInput2" class="loop-time-input" min="0" step="0.001" disabled>
                                </div>
                            </div>
                            <div class="loop-hint">
                                üí° Click to set <strong>A</strong> and <strong>B</strong> ‚Ä¢ Click again to adjust nearest marker ‚Ä¢ Hover to see time
                            </div>
                        </div>
                        <div class="tempo-volume-row">
                            <div class="volume-control-inline">
                                <label>Volume: <span id="volumeValue2">100%</span></label>
                                <input type="range" id="volumeSlider2" min="0" max="100" step="1" value="100" class="volume-slider">
                            </div>
                            <div class="tempo-control-inline">
                                <label>Tempo: <span id="tempoValue2">1.0x</span></label>
                                <input type="range" id="tempoSlider2" min="0.25" max="2.0" step="0.05" value="1.0">
                            </div>
                            <div class="stretch-control-inline">
                                <label>Stretch: <span id="stretchValue2">1.0x</span></label>
                                <input type="range" id="stretchSlider2" min="0.5" max="2.0" step="0.05" value="1.0" class="stretch-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>Low: <span id="lowValue2">0dB</span></label>
                                <input type="range" id="lowSlider2" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>Mid: <span id="midValue2">0dB</span></label>
                                <input type="range" id="midSlider2" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="eq-control-inline">
                                <label>High: <span id="highValue2">0dB</span></label>
                                <input type="range" id="highSlider2" min="-12" max="12" step="0.5" value="0" class="eq-slider">
                            </div>
                            <div class="pitch-control-inline">
                                <label>Pitch: <span id="pitchValue2">0</span></label>
                                <input type="range" id="pitchSlider2" min="-12" max="12" step="0.1" value="0" class="pitch-slider">
                            </div>
                        </div>
                        <div class="pan-control-inline">
                            <label>Pan: <span id="panValue2">Center</span></label>
                            <input type="range" id="panSlider2" min="-100" max="100" step="1" value="0" class="pan-slider">
                        </div>
                        <div class="effect-chain-container" id="effectChain2">
                            <!-- Effect chain UI will be dynamically generated here -->
                        </div>
                        <div class="effects-section">
                            <div class="effects-header">üéõÔ∏è Effects</div>
                            <div id="filterControl2" class="effect-control">
                                <label>Filter: <span id="filterValue2">20kHz</span></label>
                                <input type="range" id="filterSlider2" min="20" max="20000" step="10" value="20000" class="effect-slider">
                                <select id="filterType2" class="filter-type-select">
                                    <option value="lowpass">Low Pass</option>
                                    <option value="highpass">High Pass</option>
                                    <option value="bandpass">Band Pass</option>
                                </select>
                            </div>
                            <div id="adsrControl2" class="effect-control" style="display: none;">
                                <div class="adsr-header">
                                    <label>üìä ADSR Envelope</label>
                                    <button id="adsrTrigger2" class="adsr-trigger-btn" title="Trigger envelope">‚ö° Trigger</button>
                                </div>
                                <div class="adsr-controls">
                                    <div class="adsr-param">
                                        <label>Attack: <span id="adsrAttackValue2">10ms</span></label>
                                        <input type="range" id="adsrAttackSlider2" min="1" max="2000" step="1" value="10" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Decay: <span id="adsrDecayValue2">100ms</span></label>
                                        <input type="range" id="adsrDecaySlider2" min="1" max="2000" step="1" value="100" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Sustain: <span id="adsrSustainValue2">80%</span></label>
                                        <input type="range" id="adsrSustainSlider2" min="0" max="100" step="1" value="80" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Release: <span id="adsrReleaseValue2">300ms</span></label>
                                        <input type="range" id="adsrReleaseSlider2" min="1" max="5000" step="1" value="300" class="effect-slider">
                                    </div>
                                </div>
                            </div>
                            <div id="reverbControl2" class="effect-control">
                                <label>Reverb: <span id="reverbValue2">0%</span></label>
                                <input type="range" id="reverbSlider2" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayControl2" class="effect-control">
                                <label>Delay: <span id="delayValue2">0%</span></label>
                                <input type="range" id="delaySlider2" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayTimeControl2" class="effect-control">
                                <label>Delay Time: <span id="delayTimeValue2">300ms</span></label>
                                <input type="range" id="delayTimeSlider2" min="50" max="2000" step="50" value="300" class="effect-slider">
                            </div>
                        </div>
                        <div class="export-section">
                            <div class="export-header">üíæ Export</div>
                            <div class="export-format-selector">
                                <label>Format:</label>
                                <select id="exportFormat2" class="export-format-select">
                                    <option value="wav" selected>WAV (lossless)</option>
                                    <option value="mp3">MP3 (compressed)</option>
                                </select>
                            </div>
                            <button id="exportStem2" class="export-btn" disabled>Export Track</button>
                            <button id="exportLoop2" class="export-btn" disabled>Export Loop</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Keyboard Sampler Section -->
            <div class="keyboard-sampler-section">
                <div class="sampler-header">üéπ Keyboard Sampler</div>
                <div class="sampler-controls">
                    <div class="sampler-source-select">
                        <label>Sample Source:</label>
                        <select id="samplerSource" class="sampler-select">
                            <option value="none">-- Select Track/Clip --</option>
                            <option value="track1">Track 1 (Full)</option>
                            <option value="track2">Track 2 (Full)</option>
                            <option value="track1-loop">Track 1 (Loop Only)</option>
                            <option value="track2-loop">Track 2 (Loop Only)</option>
                            <option value="recording">Last Recording</option>
                            <option value="sequencer">Sequencer Output</option>
                        </select>
                    </div>
                    <div class="sampler-mode-select">
                        <label>Scale:</label>
                        <select id="samplerScale" class="sampler-select">
                            <option value="pentatonic-major" selected>Pentatonic Major (C-D-E-G-A)</option>
                            <option value="pentatonic-minor">Pentatonic Minor (A-C-D-E-G)</option>
                            <option value="chromatic">Chromatic (All 12 notes)</option>
                        </select>
                    </div>
                    <div class="sampler-root-select">
                        <label>Root Note:</label>
                        <select id="samplerRoot" class="sampler-select">
                            <option value="C" selected>C</option>
                            <option value="C#">C#</option>
                            <option value="D">D</option>
                            <option value="D#">D#</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                            <option value="F#">F#</option>
                            <option value="G">G</option>
                            <option value="G#">G#</option>
                            <option value="A">A</option>
                            <option value="A#">A#</option>
                            <option value="B">B</option>
                        </select>
                    </div>
                    <div class="sampler-volume-control">
                        <label>Sampler Volume: <span id="samplerVolumeValue">60%</span></label>
                        <input type="range" id="samplerVolumeSlider" min="0" max="100" step="1" value="60" class="sampler-volume-slider">
                    </div>
                    <div class="sampler-adsr-control">
                        <div class="adsr-header">
                            <label>üìä ADSR Envelope</label>
                            <input type="checkbox" id="samplerADSREnable" class="adsr-enable-checkbox">
                            <label for="samplerADSREnable" class="adsr-enable-label">Enable</label>
                        </div>
                        <div class="adsr-controls" id="samplerADSRControls" style="display: none;">
                            <div class="adsr-param">
                                <label>Attack: <span id="samplerADSRAttackValue">10ms</span></label>
                                <input type="range" id="samplerADSRAttackSlider" min="1" max="2000" step="1" value="10" class="effect-slider">
                            </div>
                            <div class="adsr-param">
                                <label>Decay: <span id="samplerADSRDecayValue">100ms</span></label>
                                <input type="range" id="samplerADSRDecaySlider" min="1" max="2000" step="1" value="100" class="effect-slider">
                            </div>
                            <div class="adsr-param">
                                <label>Sustain: <span id="samplerADSRSustainValue">80%</span></label>
                                <input type="range" id="samplerADSRSustainSlider" min="0" max="100" step="1" value="80" class="effect-slider">
                            </div>
                            <div class="adsr-param">
                                <label>Release: <span id="samplerADSRReleaseValue">300ms</span></label>
                                <input type="range" id="samplerADSRReleaseSlider" min="1" max="5000" step="1" value="300" class="effect-slider">
                            </div>
                        </div>
                    </div>
                    <div class="sampler-info">
                        <button id="enableSamplerBtn" class="control-btn sampler-btn" disabled>
                            <span class="sampler-icon">üéπ</span> Enable Sampler
                        </button>
                        <button id="disableSamplerBtn" class="control-btn sampler-btn" style="display: none;">
                            <span class="sampler-icon">‚èπÔ∏è</span> Disable Sampler
                        </button>
                        <span class="sampler-help-text">Select a source and press keys: A-S-D-F-G-H-J-K (lower octave) or Q-W-E-R-T-Y-U-I (upper octave)</span>
                    </div>
                </div>
                <div class="keyboard-visual" id="keyboardVisual" style="display: none;">
                    <div class="keyboard-row">
                        <span class="keyboard-note">Upper Octave:</span>
                        <div class="key-indicator" data-key="Q">Q</div>
                        <div class="key-indicator" data-key="W">W</div>
                        <div class="key-indicator" data-key="E">E</div>
                        <div class="key-indicator" data-key="R">R</div>
                        <div class="key-indicator" data-key="T">T</div>
                        <div class="key-indicator" data-key="Y">Y</div>
                        <div class="key-indicator" data-key="U">U</div>
                        <div class="key-indicator" data-key="I">I</div>
                    </div>
                    <div class="keyboard-row">
                        <span class="keyboard-note">Lower Octave:</span>
                        <div class="key-indicator" data-key="A">A</div>
                        <div class="key-indicator" data-key="S">S</div>
                        <div class="key-indicator" data-key="D">D</div>
                        <div class="key-indicator" data-key="F">F</div>
                        <div class="key-indicator" data-key="G">G</div>
                        <div class="key-indicator" data-key="H">H</div>
                        <div class="key-indicator" data-key="J">J</div>
                        <div class="key-indicator" data-key="K">K</div>
                    </div>
                </div>
            </div>
            
            <!-- Camera Theremin Section -->
            <div class="camera-theremin-section">
                <div class="theremin-header">üé• Camera Theremin</div>
                <div class="theremin-controls">
                    <div class="theremin-info">
                        <p class="theremin-help-text">Use your hand motion to control the theremin! Move up/down for pitch, left/right for volume.</p>
                    </div>
                    <div class="theremin-buttons">
                        <button id="enableThereminBtn" class="control-btn theremin-btn">
                            <span class="theremin-icon">üé•</span> Enable Theremin
                        </button>
                        <button id="disableThereminBtn" class="control-btn theremin-btn" style="display: none;">
                            <span class="theremin-icon">‚èπÔ∏è</span> Disable Theremin
                        </button>
                    </div>
                    <div class="theremin-video-container" id="thereminVideoContainer" style="display: none;">
                        <div class="theremin-video-wrapper">
                            <video id="thereminVideo" autoplay playsinline muted></video>
                            <canvas id="thereminCanvas"></canvas>
                            <div class="theremin-display-overlay" id="thereminDisplayOverlay">
                                <div class="theremin-value"><span id="thereminFreqLabel">Freq</span>: <span id="thereminFreqDisplay">--</span> Hz</div>
                                <div class="theremin-value"><span id="thereminVolLabel">Vol</span>: <span id="thereminVolDisplay">--</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="theremin-settings" id="thereminSettings" style="display: none;">
                        <div class="theremin-setting">
                            <label>Control Mapping:</label>
                            <select id="thereminMappingMode" class="theremin-select">
                                <option value="pitch-volume" selected>Pitch & Volume (Classic)</option>
                                <option value="filter-resonance">Filter & Resonance</option>
                                <option value="adsr">ADSR Envelope</option>
                            </select>
                            <div class="theremin-mapping-help" id="thereminMappingHelp">
                                <small>‚ÜïÔ∏è Pitch | ‚ÜîÔ∏è Volume</small>
                            </div>
                        </div>
                        <div class="theremin-setting">
                            <label>Volume: <span id="thereminVolumeValue">50%</span></label>
                            <input type="range" id="thereminVolumeSlider" min="0" max="100" step="1" value="50" class="theremin-slider">
                        </div>
                        <div class="theremin-setting">
                            <label>Audio Source:</label>
                            <select id="thereminAudioSource" class="theremin-select">
                                <option value="oscillator" selected>Oscillator (Synthesizer)</option>
                                <option value="track1">Track 1</option>
                                <option value="track2">Track 2</option>
                                <option value="sequencer">Sequencer Output</option>
                            </select>
                        </div>
                        <div class="theremin-setting" id="thereminWaveformSetting">
                            <label>Waveform:</label>
                            <select id="thereminWaveform" class="theremin-select">
                                <option value="sine" selected>Sine (Pure)</option>
                                <option value="triangle">Triangle (Soft)</option>
                                <option value="sawtooth">Sawtooth (Bright)</option>
                                <option value="square">Square (Retro)</option>
                            </select>
                        </div>
                        <div class="theremin-setting">
                            <label>Pitch Range:</label>
                            <select id="thereminRange" class="theremin-select">
                                <option value="low">Low (100-800Hz)</option>
                                <option value="medium" selected>Medium (200-2000Hz)</option>
                                <option value="high">High (400-4000Hz)</option>
                                <option value="wide">Wide (100-4000Hz)</option>
                            </select>
                        </div>
                        <div class="theremin-setting">
                            <label>Vibrato Rate: <span id="thereminVibratoRateValue">5Hz</span></label>
                            <input type="range" id="thereminVibratoRate" min="0" max="15" step="0.5" value="5" class="theremin-slider">
                        </div>
                        <div class="theremin-setting">
                            <label>Vibrato Depth: <span id="thereminVibratoDepthValue">10Hz</span></label>
                            <input type="range" id="thereminVibratoDepth" min="0" max="50" step="1" value="10" class="theremin-slider">
                        </div>
                        <div class="theremin-setting">
                            <label>Detection Sensitivity: <span id="thereminSensitivityValue">1.5x</span></label>
                            <input type="range" id="thereminSensitivity" min="0.5" max="3.0" step="0.1" value="1.5" class="theremin-slider">
                            <small style="opacity: 0.7;">Adjust for lighting conditions</small>
                        </div>
                        <div class="theremin-setting">
                            <label class="routing-toggle">
                                <input type="checkbox" id="thereminRequireHand">
                                <span>Require hand detection (disable for easier activation)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Master Channel Effects -->
        <div class="master-effects-section">
            <div class="master-effects-header">
                <span class="master-title">üéöÔ∏è Master Output</span>
            </div>
            <div class="master-effects-content">
                <!-- Master Routing Controls -->
<div class="master-routing-section">
                    <div class="routing-header">üéõÔ∏è Routing</div>
                    <div class="routing-controls">
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeTrack1" checked>
                            <span>üéµ Track 1</span>
                            <span class="activity-indicator" id="activityTrack1"></span>
                        </label>
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeTrack2" checked>
                            <span>üéµ Track 2</span>
                            <span class="activity-indicator" id="activityTrack2"></span>
                        </label>
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeMicrophone" checked>
                            <span>üé§ Microphone</span>
                            <span class="activity-indicator" id="activityMicrophone"></span>
                        </label>
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeSampler" checked>
                            <span>üéπ Sampler</span>
                            <span class="activity-indicator" id="activitySampler"></span>
                        </label>
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeTheremin" checked>
                            <span>üé• Theremin</span>
                            <span class="activity-indicator" id="activityTheremin"></span>
                        </label>
                        <label class="routing-toggle">
                            <input type="checkbox" id="routeSequencer" checked>
                            <span>üéº Sequencer</span>
                            <span class="activity-indicator" id="activitySequencer"></span>
                        </label>
                    </div>
                </div>
                
                <!-- Main Controls Row (Volume/Pan left, Effects right) -->
                <div class="master-controls-row">
                    <!-- Left Side: Volume and Pan -->
                    <div class="master-volume-pan-section">
                        <div class="master-volume-control">
                            <label>Master Volume: <span id="masterVolumeValue">100%</span></label>
                            <input type="range" id="masterVolumeSlider" min="0" max="100" step="1" value="100" class="volume-slider">
                        </div>
                        <div class="master-pan-control">
                            <label>Master Pan: <span id="masterPanValue">Center</span></label>
                            <input type="range" id="masterPanSlider" min="-100" max="100" step="1" value="0" class="pan-slider">
                        </div>
                    </div>
                    
                    <!-- Right Side: Effects -->
                    <div class="master-effects-wrapper">
                        <div class="effect-chain-container" id="effectChainMaster">
                            <!-- Master effect chain UI will be dynamically generated here -->
                        </div>
                        <div class="effects-section">
                            <div class="effects-header">üéõÔ∏è Master Effects</div>
                            <div id="filterControlMaster" class="effect-control">
                                <label>Filter: <span id="filterValueMaster">20kHz</span></label>
                                <input type="range" id="filterSliderMaster" min="20" max="20000" step="10" value="20000" class="effect-slider">
                                <select id="filterTypeMaster" class="filter-type-select">
                                    <option value="lowpass">Low Pass</option>
                                    <option value="highpass">High Pass</option>
                                    <option value="bandpass">Band Pass</option>
                                </select>
                            </div>
                            <div id="adsrControlMaster" class="effect-control" style="display: none;">
                                <div class="adsr-header">
                                    <label>üìä ADSR Envelope</label>
                                    <button id="adsrTriggerMaster" class="adsr-trigger-btn" title="Trigger envelope">‚ö° Trigger</button>
                                </div>
                                <div class="adsr-controls">
                                    <div class="adsr-param">
                                        <label>Attack: <span id="adsrAttackValueMaster">10ms</span></label>
                                        <input type="range" id="adsrAttackSliderMaster" min="1" max="2000" step="1" value="10" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Decay: <span id="adsrDecayValueMaster">100ms</span></label>
                                        <input type="range" id="adsrDecaySliderMaster" min="1" max="2000" step="1" value="100" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Sustain: <span id="adsrSustainValueMaster">80%</span></label>
                                        <input type="range" id="adsrSustainSliderMaster" min="0" max="100" step="1" value="80" class="effect-slider">
                                    </div>
                                    <div class="adsr-param">
                                        <label>Release: <span id="adsrReleaseValueMaster">300ms</span></label>
                                        <input type="range" id="adsrReleaseSliderMaster" min="1" max="5000" step="1" value="300" class="effect-slider">
                                    </div>
                                </div>
                            </div>
                            <div id="reverbControlMaster" class="effect-control">
                                <label>Reverb: <span id="reverbValueMaster">0%</span></label>
                                <input type="range" id="reverbSliderMaster" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayControlMaster" class="effect-control">
                                <label>Delay: <span id="delayValueMaster">0%</span></label>
                                <input type="range" id="delaySliderMaster" min="0" max="100" step="1" value="0" class="effect-slider">
                            </div>
                            <div id="delayTimeControlMaster" class="effect-control">
                                <label>Delay Time: <span id="delayTimeValueMaster">300ms</span></label>
                                <input type="range" id="delayTimeSliderMaster" min="50" max="2000" step="50" value="300" class="effect-slider">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recording Section -->
                <div class="recording-section">
                    <div class="recording-header">‚è∫Ô∏è Master Recording</div>
                    <div class="recording-controls">
                        <button id="recordBtn" class="control-btn" disabled>
                            <span class="record-icon">‚è∫Ô∏è</span> Start Recording
                        </button>
                        <button id="stopRecordBtn" class="control-btn" disabled style="display: none;">
                            <span class="record-icon">‚èπÔ∏è</span> Stop Recording
                        </button>
                        <span id="recordingTime" class="recording-time" style="display: none;">0:00</span>
                    </div>
                    <div class="recording-export-group" style="display: none;" id="recordingExportGroup">
                        <div class="recording-format-selector">
                            <label>Format:</label>
                            <select id="recordingExportFormat" class="recording-format-select">
                                <option value="webm" selected>WebM (original)</option>
                                <option value="wav">WAV (lossless)</option>
                                <option value="mp3">MP3 (compressed)</option>
                            </select>
                        </div>
                        <button id="downloadBtn" class="control-btn">
                            <span class="record-icon">üíæ</span> Download Recording
                        </button>
                        <button id="loadToTrack1Btn" class="control-btn">
                            <span class="record-icon">üì•</span> Load to Track 1
                        </button>
                        <button id="loadToTrack2Btn" class="control-btn">
                            <span class="record-icon">üì•</span> Load to Track 2
                        </button>
                    </div>
                    <div class="recording-waveform-container" style="display: none;">
                        <label>Recorded Output:</label>
                        <canvas id="recordingWaveform" class="waveform-canvas"></canvas>
                        <audio id="recordedAudio" controls></audio>
                    </div>
                </div>
            </div>
            </div>
            <!-- End DJ Mixer Tab -->

            <!-- Sequencer Tab -->
            <div id="sequencer-tab" class="tab-content">
                <div class="sequencer-container" id="sequencerContainer">
                    <div class="sequencer-header">
                        <h2>üéº Sequencer</h2>
                        <div class="sequencer-controls">
                            <button id="sequencerPlayBtn" class="sequencer-btn">‚ñ∂Ô∏è Play</button>
                            <button id="sequencerPauseBtn" class="sequencer-btn">‚è∏Ô∏è Pause</button>
                            <button id="sequencerStopBtn" class="sequencer-btn">‚èπÔ∏è Stop</button>
                            <button id="sequencerLoopToggleBtn" class="sequencer-btn" title="Toggle timeline looping">üîÅ Loop</button>
                            <button id="sequencerRecordBtn" class="sequencer-btn">‚è∫Ô∏è Record</button>
                            <button id="addBarBtn" class="sequencer-btn">‚ûï Add Bar</button>
                            <button id="removeBarBtn" class="sequencer-btn">‚ûñ Remove Bar</button>
                            <label class="bpm-control">
                                BPM: <input type="number" id="sequencerBPM" value="120" min="60" max="200" step="1">
                            </label>
                            <button id="sequencerAutoTimestrechBtn" class="sequencer-btn" title="Auto-timestretch clips to match project BPM">üéµ Auto-Stretch</button>
                            <label class="cache-status" id="cacheStatus" title="Timestretched buffer cache size">
                                Cache: <span id="cacheSize">0 MB</span> / 200 MB
                            </label>
                            <button id="clearCacheBtn" class="sequencer-btn" title="Clear timestretched buffer cache">üóëÔ∏è Clear Cache</button>
                            <button id="saveProjectBtn" class="sequencer-btn" title="Save project to browser storage">üíæ Save</button>
                            <button id="loadProjectBtn" class="sequencer-btn" title="Load project from browser storage">üìÇ Load</button>
                            <button id="exportProjectBtn" class="sequencer-btn" title="Export project as JSON file">üì• Export</button>
                            <button id="importProjectBtn" class="sequencer-btn" title="Import project from file">üì§ Import</button>
                            <input type="file" id="importProjectInput" accept=".json" style="display: none;">
                            <label class="zoom-control">
                                Zoom: <input type="range" id="sequencerZoom" value="100" min="50" max="300" step="10" style="width: 100px;">
                                <span id="zoomValue">100%</span>
                            </label>
                            <label class="bpm-control" style="display: none;" id="loopRangeControl">
                                Loop: Bar <input type="number" id="loopStartBar" value="1" min="1" max="8" step="1" style="width: 50px;">
                                to <input type="number" id="loopEndBar" value="8" min="1" max="8" step="1" style="width: 50px;">
                            </label>
                            <button id="toggleEffectsPanelBtn" class="sequencer-btn" title="Toggle effects panel">üéõÔ∏è Effects Panel</button>
                            <button id="sequencerFullscreenBtn" class="sequencer-btn" title="Toggle fullscreen">‚õ∂ Fullscreen</button>
                        </div>
                    </div>
                    
                    <!-- Sequencer Recording Section -->
                    <div class="sequencer-recording-section" id="sequencerRecordingSection" style="display: none;">
                        <div class="recording-header">‚è∫Ô∏è Sequencer Recording</div>
                        <div class="recording-controls">
                            <button id="stopSequencerRecordBtn" class="control-btn">
                                <span class="record-icon">‚èπÔ∏è</span> Stop Recording
                            </button>
                            <span id="sequencerRecordingTime" class="recording-time">0:00</span>
                        </div>
                        <div class="recording-export-group" style="display: none;" id="sequencerExportGroup">
                            <div class="recording-format-selector">
                                <label>Format:</label>
                                <select id="sequencerExportFormat" class="recording-format-select">
                                    <option value="webm" selected>WebM (original)</option>
                                    <option value="wav">WAV (lossless)</option>
                                    <option value="mp3">MP3 (compressed)</option>
                                </select>
                            </div>
                            <button id="downloadSequencerBtn" class="control-btn">
                                <span class="record-icon">üíæ</span> Download Recording
                            </button>
                            <button id="loadSequencerToTrack1Btn" class="control-btn">
                                <span class="record-icon">üì•</span> Load to Track 1
                            </button>
                            <button id="loadSequencerToTrack2Btn" class="control-btn">
                                <span class="record-icon">üì•</span> Load to Track 2
                            </button>
                        </div>
                        <div class="recording-waveform-container" style="display: none;">
                            <label>Recorded Sequencer:</label>
                            <div class="waveform-container">
                                <canvas id="sequencerRecordingWaveform" class="waveform-canvas"></canvas>
                                <div id="sequencerLoopMarkerStart" class="loop-marker loop-marker-start" style="display: none;">A</div>
                                <div id="sequencerLoopMarkerEnd" class="loop-marker loop-marker-end" style="display: none;">B</div>
                                <div id="sequencerLoopRegion" class="loop-region" style="display: none;"></div>
                            </div>
                            <div class="sequencer-recording-controls">
                                <button id="sequencerLoopBtn" class="control-btn-small loop-btn" title="Enable loop (click waveform twice to set A-B points)">üîÅ</button>
                                <button id="sequencerClearLoopBtn" class="control-btn-small" title="Clear loop points">‚ùå Clear Loop</button>
                            </div>
                            <audio id="sequencerRecordedAudio" controls></audio>
                        </div>
                    </div>

                    <div class="sequencer-workspace">
                        <!-- Source Clips Panel -->
                        <div class="clips-panel">
                            <h3>Available Clips</h3>
                            <div class="sequencer-upload-section">
                                <label for="sequencerAudioUpload" class="sequencer-upload-btn">
                                    üìÅ Choose Audio File
                                </label>
                                <input type="file" id="sequencerAudioUpload" accept="audio/*" multiple style="display: none;">
                                <div class="sequencer-upload-help">
                                    Upload or drag & drop audio files here
                                </div>
                            </div>
                            <div id="clipsList" class="clips-list">
                                <div class="clip-help-text">
                                    Upload files above or load tracks in the DJ Mixer tab
                                </div>
                            </div>
                        </div>

                        <!-- Sequencer Timeline -->
                        <div class="sequencer-timeline-container">
                            <div class="timeline-header">
                                <!-- Timeline Loop Markers -->
                                <div id="timelineLoopMarkerStart" class="timeline-loop-marker timeline-loop-marker-start" style="display: none;">
                                    <div class="timeline-loop-marker-label">START</div>
                                </div>
                                <div id="timelineLoopMarkerEnd" class="timeline-loop-marker timeline-loop-marker-end" style="display: none;">
                                    <div class="timeline-loop-marker-label">END</div>
                                </div>
                                <div id="timelineLoopRegion" class="timeline-loop-region" style="display: none;"></div>
                                
                                <div class="timeline-ruler" id="timelineRuler">
                                    <!-- Bar markers will be generated here -->
                                </div>
                            </div>
                            <div class="sequencer-tracks" id="sequencerTracks">
                                <!-- Tracks will be added dynamically -->
                            </div>
                        </div>

                        <!-- Clip Effects Panel -->
                        <div class="sequencer-effects-panel" id="sequencerEffectsPanel" style="display: none;">
                            <div class="sequencer-effects-header">
                                <h3>üéõÔ∏è Clip Effects</h3>
                                <div class="selected-clip-info">
                                    <span id="selectedClipName">No clip selected</span>
                                    <div class="clip-header-buttons">
                                        <button id="deleteClipBtn" class="delete-clip-btn" title="Delete this clip from track">üóëÔ∏è</button>
                                        <button id="closeClipEffects" class="close-effects-btn">‚úï</button>
                                    </div>
                                </div>
                            </div>
                            <div class="sequencer-effects-controls">
                                <!-- Volume Control -->
                                <div class="clip-effect-control">
                                    <label>Volume: <span id="clipVolumeValue">100%</span></label>
                                    <input type="range" id="clipVolumeSlider" min="0" max="150" step="1" value="100" class="effect-slider">
                                </div>
                                
                                <!-- Pitch Control -->
                                <div class="clip-effect-control">
                                    <label>Pitch: <span id="clipPitchValue">0</span></label>
                                    <input type="range" id="clipPitchSlider" min="-12" max="12" step="0.1" value="0" class="effect-slider">
                                </div>
                                
                                <!-- Filter Control -->
                                <div class="clip-effect-control">
                                    <label>Filter: <span id="clipFilterValue">20kHz</span></label>
                                    <input type="range" id="clipFilterSlider" min="20" max="20000" step="10" value="20000" class="effect-slider">
                                    <select id="clipFilterType" class="filter-type-select">
                                        <option value="lowpass">Low Pass</option>
                                        <option value="highpass">High Pass</option>
                                        <option value="bandpass">Band Pass</option>
                                    </select>
                                </div>
                                
                                <!-- ADSR Envelope Control -->
                                <div class="clip-effect-control">
                                    <div class="adsr-header">
                                        <label>üìä ADSR Envelope</label>
                                        <button id="clipAdsrTrigger" class="adsr-trigger-btn" title="Trigger envelope">‚ö° Trigger</button>
                                    </div>
                                    <div class="adsr-controls">
                                        <div class="adsr-param">
                                            <label>Attack: <span id="clipAdsrAttackValue">10ms</span></label>
                                            <input type="range" id="clipAdsrAttackSlider" min="1" max="2000" step="1" value="10" class="effect-slider">
                                        </div>
                                        <div class="adsr-param">
                                            <label>Decay: <span id="clipAdsrDecayValue">100ms</span></label>
                                            <input type="range" id="clipAdsrDecaySlider" min="1" max="2000" step="1" value="100" class="effect-slider">
                                        </div>
                                        <div class="adsr-param">
                                            <label>Sustain: <span id="clipAdsrSustainValue">80%</span></label>
                                            <input type="range" id="clipAdsrSustainSlider" min="0" max="100" step="1" value="80" class="effect-slider">
                                        </div>
                                        <div class="adsr-param">
                                            <label>Release: <span id="clipAdsrReleaseValue">300ms</span></label>
                                            <input type="range" id="clipAdsrReleaseSlider" min="1" max="5000" step="1" value="300" class="effect-slider">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Reverb Control -->
                                <div class="clip-effect-control">
                                    <label>Reverb: <span id="clipReverbValue">0%</span></label>
                                    <input type="range" id="clipReverbSlider" min="0" max="100" step="1" value="0" class="effect-slider">
                                </div>
                                
                                <!-- Delay Control -->
                                <div class="clip-effect-control">
                                    <label>Delay: <span id="clipDelayValue">0%</span></label>
                                    <input type="range" id="clipDelaySlider" min="0" max="100" step="1" value="0" class="effect-slider">
                                </div>
                                
                                <!-- Delay Time Control -->
                                <div class="clip-effect-control">
                                    <label>Delay Time: <span id="clipDelayTimeValue">300ms</span></label>
                                    <input type="range" id="clipDelayTimeSlider" min="50" max="2000" step="50" value="300" class="effect-slider">
                                </div>
                                
                                <!-- Reset Button -->
                                <div class="clip-effect-control">
                                    <button id="resetClipEffects" class="sequencer-btn" style="width: 100%;">Reset All Effects</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Sequencer Tab -->
        </div>
        
        <div class="visualization-wrapper">
            <div id="visualizer-container" class="visualizer-container">
                <div class="visualization-mode">
                    <label>Mode:</label>
                    <button id="modeCircle" class="mode-btn active">üîµ Circle</button>
                    <button id="modeBars" class="mode-btn">üìä Bars</button>
                    <button id="modeSphere" class="mode-btn">üåê Sphere</button>
                </div>
                
                <div id="placeholder" class="placeholder">
                    <p>Upload audio files to get started</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">Upload two tracks to mix them together!</p>
                    <p style="font-size: 0.8rem; margin-top: 15px; color: rgba(255, 255, 255, 0.5);">
                        Supported formats: MP3, WAV, OGG, M4A, AAC, FLAC*, AIFF*, OPUS, WEBM
                    </p>
                    <p style="font-size: 0.7rem; margin-top: 5px; color: rgba(255, 255, 255, 0.4);">
                        *FLAC/AIFF may not play in Safari. Use Chrome/Firefox for best compatibility.
                    </p>
                </div>
            </div>
            
            <div id="oscilloscope-container" class="oscilloscope-container">
                <div class="oscilloscope-header">
                    <label>Oscilloscope</label>
                </div>
                <canvas id="oscilloscope" class="oscilloscope-canvas"></canvas>
            </div>
        </div>
        
        <audio id="audioElement1" hidden></audio>
        <audio id="audioElement2" hidden></audio>
    </div>
    
    <footer class="credits">
        Made by Lior Shahverdi and Claude Sonnet 4.5 in VS Code.
    </footer>
    
    <script type="module" src="{{ url_for('static', filename='js/modules/activity-indicators.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>